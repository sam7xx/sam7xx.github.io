var searchCache=null,searchCacheKey="search_cache_v1",searchFunc=function(e,d,n,c,s){function m(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function t(e){var r,t,a=document.getElementById(c);a&&!a._searchInitialized&&(a._searchInitialized=!0,r=document.getElementById(s),t=document.getElementById(n),a.addEventListener("input",function(){var u=[],p=(r=>{var a=[];for(let t=0;t<r.length;t++)for(let e=t+1;e<=Math.min(t+3,r.length);e++)a.push(r.slice(t,e).join(" "));return a})(this.value.trim().toLowerCase().split(" ")).sort(function(e,t){return t.split(" ").length-e.split(" ").length});if(r.innerHTML="",this.value.trim().length<=0)t.setAttribute("searching","false");else if(t.setAttribute("searching","true"),e.forEach(function(e){var t,r,a,n,c,s,h,l,i,o;!e.content?.trim().length||d&&!e.path.includes(d)||(t=0,i=e.title?.trim()||"Untitled",r=i.toLowerCase(),o=e.content,a=o.toLowerCase(),e=(e=(e=e.path.startsWith("//")?e.path.slice(1):e.path).replace(/\/?index\.html$/,"/")).replace(/\.html$/,"/"),s=c=n=-1,p.forEach(function(e){n=r.indexOf(e),c=a.indexOf(e),(0<=n||0<=c)&&(t+=1,c<0&&(c=0),s<0)&&(s=c)}),0<t&&(h=document.createElement("li"),(l=document.createElement("a")).href=e,(e=document.createElement("span")).className="search-result-title",e.textContent=i,l.appendChild(e),0<=s&&(i=Math.max(0,s-20),e=Math.min(o.length,s+80),o=o.substring(i,e=0===i?100:e),i=new RegExp(p.map(m).join("|"),"gi"),o=o.replace(i,function(e){return'<span class="search-keyword">'+e+"</span>"}),(e=document.createElement("p")).className="search-result-content",e.innerHTML=o+"...",l.appendChild(e)),h.appendChild(l),u.push({rank:t,element:h})))}),u.length){u.sort(function(e,t){return t.rank-e.rank});let t=document.createElement("ul");t.className="search-result-list",u.forEach(function(e){t.appendChild(e.element)}),r.innerHTML="",r.appendChild(t)}}))}if(searchCache)t(searchCache);else{let e=setInterval(()=>{searchCache&&(clearInterval(e),t(searchCache))},100)}};utils.jq(()=>{var e=ctx.search.path;e.startsWith("/")&&(e=e.substring(1)),e=ctx.root+e;try{var t=localStorage.getItem(searchCacheKey);t&&(searchCache=JSON.parse(t))}catch(e){console.warn("搜索缓存解析失败",e)}fetch(e).then(e=>e.json()).then(e=>{searchCache=e;try{localStorage.setItem(searchCacheKey,JSON.stringify(e))}catch(e){console.warn("搜索缓存写入失败",e)}});var r,a=$("input#search-input");0!=a.length&&(r=document.querySelector("div#search-result"),a.focus(function(){var e=ctx.search.path,t=(e.startsWith("/")&&(e=e.substring(1)),e=ctx.root+e,a.attr("data-filter")||"");searchFunc(e,t,"search-wrapper","search-input","search-result")}),a.keydown(function(e){13==e.which&&e.preventDefault()}),new MutationObserver(function(e){var t=r.querySelector(".search-result-list li");$(".search-wrapper").toggleClass("noresult",!t)}).observe(r,{childList:!0,subtree:!0}))});