class Sakura{constructor(t,e,n,i,a,r){this.x=t,this.y=e,this.s=n,this.r=i,this.fn=a,this.image=r}draw(t){t.save(),t.translate(this.x,this.y),t.rotate(this.r);var e=40*this.s;t.drawImage(this.image,-e/2,-e/2,e,e),t.restore()}update(){this.x=this.fn.x(this.x,this.y),this.y=this.fn.y(this.y,this.x),this.r=this.fn.r(this.r),(this.x>window.innerWidth||this.x<0||this.y>window.innerHeight||this.y<0)&&this.reset()}reset(){this.r=getRandom("fnr")(),.4<Math.random()?(this.x=getRandom("x"),this.y=0):(this.x=window.innerWidth,this.y=getRandom("y")),this.s=getRandom("s"),this.r=getRandom("r")}}let stop=null;function isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768}function getRandom(t){switch(t){case"x":return Math.random()*window.innerWidth;case"y":return Math.random()*window.innerHeight;case"s":return.5*Math.random()+.3;case"r":return Math.random()*Math.PI*2;case"fnx":return(t,e)=>t+2*(Math.random()-.5)-1;case"fny":return(t,e)=>t+1.5+Math.random();case"fnr":return t=>t+.03*Math.random();default:return 0}}function startSakura(e){if(stop){cancelAnimationFrame(stop);let t=document.getElementById("canvas_sakura");t&&t.remove()}let n=document.createElement("canvas"),i=n.getContext("2d"),a=[];var r=isMobileDevice()?15:25;n.height=window.innerHeight,n.width=window.innerWidth,n.style.cssText="position:fixed;left:0;top:0;pointer-events:none;z-index:9999;",n.id="canvas_sakura",document.body.appendChild(n);for(let t=0;t<r;t++)a.push(new Sakura(getRandom("x"),getRandom("y"),getRandom("s"),getRandom("r"),{x:getRandom("fnx"),y:getRandom("fny"),r:getRandom("fnr")},e));stop=requestAnimationFrame(function t(){i.clearRect(0,0,n.width,n.height),a.forEach(t=>{t.update(),t.draw(i)}),stop=requestAnimationFrame(t)})}function toggleSakura(e){var t;if(stop)return cancelAnimationFrame(stop),stop=null,(t=document.getElementById("canvas_sakura"))&&t.remove(),!1;{if(isMobileDevice())if(!confirm("在移动设备上运行樱花特效可能会影响性能。是否继续？"))return!1;let t=new Image;return t.onload=function(){startSakura(t)},t.src=e,!0}}window.addEventListener("resize",()=>{var t=document.getElementById("canvas_sakura");t&&(t.width=window.innerWidth,t.height=window.innerHeight)}),window.addEventListener("beforeunload",()=>{stop&&cancelAnimationFrame(stop)}),toggleSakura("https://u.sam7.top/2NkzEk"),window.toggleSakura=toggleSakura,window.isMobileDevice=isMobileDevice;